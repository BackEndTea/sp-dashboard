# This DI configuration file containes overrides on the DashboardBundle configuration,
# typically to replace doctrine repositories with in-memory repositories.
services:
    surfnet.dashboard.command_handler.publish_entity:
        class: Surfnet\ServiceProviderDashboard\Webtests\CommandHandler\MockPublishEntityCommandHandler
        public: true
        tags:
            - { name: tactician.handler, command: Surfnet\ServiceProviderDashboard\Application\Command\Entity\PublishEntityCommand }

    surfnet.dashboard.mailer:
        class: Surfnet\ServiceProviderDashboard\Webtests\Mailer\FakeMailer
        public: true

    surfnet.dashboard.metadata.fetcher:
        class: Surfnet\ServiceProviderDashboard\Webtests\Metadata\FakeFetcher

    surfnet.dashboard.session.storage.mock_file:
        class: Surfnet\ServiceProviderDashboard\Webtests\Session\Storage\MockFileSessionStorage
        arguments:
            - '%kernel.cache_dir%/sessions/'
            - 'MOCKSESSID'
            - '@session.storage.metadata_bag'

    surfnet.dashboard.validator.logo:
        class: Surfnet\ServiceProviderDashboard\Webtests\Validator\Constraints\MockValidLogoValidator
        tags:
            - { name: validator.constraint_validator, alias: logo }

    surfnet.dashboard.validator.entity_id:
        class: Surfnet\ServiceProviderDashboard\Webtests\Validator\Constraints\MockEntityIdValidator
        tags:
            - { name: validator.constraint_validator, alias: entity_id }

    surfnet.manage.http.guzzle.mock_handler:
        class: GuzzleHttp\Handler\MockHandler
        public: true

    surfnet.manage.http.guzzle.test_environement:
        class: GuzzleHttp\Client
        arguments:
        - handler: '@surfnet.manage.http.guzzle.mock_handler'

    # These services are overloaded for functional tests and have been made public to prevent:
    #
    # > The "logger" service is private, getting it from the container is
    # > deprecated since Symfony 3.2 and will fail in 4.0.
    logger:
        alias: 'monolog.logger'
        public: true

    surfnet.dashboard.repository.entity:
        class: Surfnet\ServiceProviderDashboard\Infrastructure\DashboardBundle\Repository\EntityRepository
        factory: ['@doctrine', 'getRepository']
        arguments: [Surfnet\ServiceProviderDashboard\Domain\Entity\Entity]
        public: true

    surfnet.dashboard.repository.privacy_questions:
        class: Surfnet\ServiceProviderDashboard\Infrastructure\DashboardBundle\Repository\PrivacyQuestionsRepository
        factory: ['@doctrine', 'getRepository']
        arguments: [Surfnet\ServiceProviderDashboard\Domain\Entity\PrivacyQuestions]
        public: true

    surfnet.dashboard.repository.service:
        class: Surfnet\ServiceProviderDashboard\Infrastructure\DashboardBundle\Repository\ServiceRepository
        factory: ['@doctrine', 'getRepository']
        arguments: [Surfnet\ServiceProviderDashboard\Domain\Entity\Service]
        public: true

    surfnet.dashboard.service.authorization:
        class: Surfnet\ServiceProviderDashboard\Infrastructure\DashboardBundle\Service\AuthorizationService
        public: true